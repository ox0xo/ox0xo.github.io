---
layout: post
title:  "DNSの観測"
date:   2018-08-21
permalink: /networking/:title
categories: DNS
tags: dns
excerpt: DNSに関するポストです
mathjax: false
---

* content
{:toc}

## DNSの観測
- 前提の確認

手元の仮想マシンにはDNSサーバがインストールされており`www.sample.local`を172.16.0.100に名前解決する設定になっています。
127.0.0.1のポート53番に送信したDNSリクエストがNATのポートフォワードによって仮想マシンに転送されます。

![]({{site.baseurl}}/images/dns/dns_01.png)

仮想マシンを利用するためにWindowsのTCP/IPv4のプロパティを変更します。
この設定によりWindowsから仮想マシン上のDNSを参照できるようになります。
但しインターネット接続が出来なくなるため最後に設定を元に戻すことを忘れないでください。

![]({{site.baseurl}}/images/dns/nic_dns_change01.png)

![]({{site.baseurl}}/images/dns/nic_dns_change02.png)

- DNSリクエスト・レスポンスの確認

DDNSリクエストを発行するためにWindowsコマンドプロンプトからnslookupを使い`www.sample.local`のIPアドレスを問い合わせます。
```
> nslookup www.sample.local
サーバー:  localhost
Address:  127.0.0.1

名前:    www.sample.local
Address:  172.16.0.100
```
この時のパケットから抜粋したDNSメッセージ（リクエストとレスポンス）を以下に示します。
主に確認すべき項目はQueries（IPアドレスを問い合わせたいホスト名）とAnswers（IPアドレス）です。
`www.sample.local`を問い合わせた結果172.16.0.100が返されていることが読み取れます。
```
Domain Name System (query)
    Transaction ID: 0x0002
    Flags: 0x0100 Standard query
    Questions: 1
    Answer RRs: 0
    Authority RRs: 0
    Additional RRs: 0
    Queries
        www.sample.local: type A, class IN
            Name: www.sample.local
            [Name Length: 16]
            [Label Count: 3]
            Type: A (Host Address) (1)
            Class: IN (0x0001)
```
```
Domain Name System (response)
    Transaction ID: 0x0002
    Flags: 0x8580 Standard query response, No error
    Questions: 1
    Answer RRs: 1
    Authority RRs: 1
    Additional RRs: 1
    Queries
        www.sample.local: type A, class IN
            Name: www.sample.local
            [Name Length: 16]
            [Label Count: 3]
            Type: A (Host Address) (1)
            Class: IN (0x0001)
    Answers
        www.sample.local: type A, class IN, addr 172.16.0.100
            Name: www.sample.local
            Type: A (Host Address) (1)
            Class: IN (0x0001)
            Time to live: 86400
            Data length: 4
            Address: 172.16.0.100
```
