---
layout: post
title:  "Netwitness Hunting Guide"
date:   2018-09-18
permalink: /security/:title
categories: Security
tags: Netwitness
excerpt: Netwitnessハンティングガイドの和訳
mathjax: false
---

* content
{:toc}

RSA NetWitness Platformは、旧称セキュリティアナリティクスと呼ばれるNetWitness NextGenセキュリティ製品の後継です。
ネットワークトラフィックとログを取り込み、データに対して複数の論理層を適用し、カスタムデータベースに値を格納し、メタデータを統一ビューでアナリストに提示します。
ホストベースのメモリフォレンジックツールであるECATと統合すると、ホストアクティビティに関するメタデータが生成され、同じビューに表示され、アナリストはネットワークの状態を比類のないものにすることができます。
このガイドでは、悪意のある活動のパケットデータセットを調べるための戦術と手順について説明します。

NetWitnessは、一般的なネットワークトラフィックベースのセンサーではなく、IDS/IPSまたはNetflowデバイスではありませんが、より基本的な機能の中には重複するものもあります。
メタデータは、ネットワークセッション内の技術的側面または動作を記述するために生成されます。
セッションは通常、リクエストとレスポンスから成る1つまたは2つの関連するトラフィックストリームとして定義されます。
これらのセッションはキャプチャされた時間によって順序付けられ、このような時間の情報は調査を開始するときにデータベースに適用される最初の条件式になります。
データがどのように収集され、発注されたかを知ることは、NetWitnessをどのように捜索するかを理解する上で不可欠です。

NetWitnessのメタデータは、従来のIDS/IPSで使用されているようなシグネチャではなく、別の方法で処理する必要があるアクティビティのインジケータとみなす必要があります。
NetWitnessパーサーに含まれるロジックは、標準的な正規表現ベースのシグネチャよりもはるかに汎用性があります。
トラフィックを処理するパーサー、フィード、アプリケーションルールは、データの構造に関するメタデータを生成し、効率的に検索できる個々のセッションから値を抽出します。
これは従来のIDS/IPSソリューションとは異なり、以前に特定された悪意のあるアクティビティを特定するだけではなく、新たな未知の悪意のあるアクティビティを見つけることが可能です。
シグネチャのようなパーサーも含まれていますが、パーサーエンジンでは一般的なスクリプト言語Luaによる複雑なロジックを使用して判断しており、偽陽性率がはるかに低くなります。
このガイドでは、RSA Liveコンテンツ管理システムによって提供されるコンテンツを使用して、未知の新たな悪意のあるアクティビティを捜すことに焦点を当てています。
通常、シグネチャのようなパーサーの概要は含まれていません。

NetWitnessデータセット内でのハンティングは、不正侵入を分析し、マルウェアをリバースエンジニアリングし、マルウェアやその他の攻撃によって生成されたトラフィックを分析し、このタイプの動作に基づいてNetWitnessによって生成されたメタデータを選択することによって達成されます。
RSA IRチームは2012年に設立されて以来多くの調査を行い、アナリストが行動の多くの側面を単一のメタデータに組み合わせることで迅速にデータセットをナビゲートできるようにするプラットフォームのコンテンツと戦術を作成しました。
これにより、目的の動作でセッションを検索するのに必要なドリルダウンの数が削減され、プラットフォームのパフォーマンスが向上し、悪意のある動作を検出するのに必要な労力が削減されます。
これにより、IRチームは、組織が標的とされた攻撃を受けているという事前の知識や通知なしにインシデントを発見することができました。
IRチームはまた、これらの方法論とコンテンツを使用して、攻撃者がマルウェアを使用していない多くのインシデントを検出しましたが、認証されたアクセスは「LANd」と呼ばれています。

NetWitnessによって提供されるネットワークトラフィックの前例のない見方は、インシデント対応機能にとって最も効果的ですが、セキュリティポリシーの適切な施行の検証や、これらのポリシーや手順の改善が必要な領域の発見にも使用できます。
このガイドは、既知の脅威に基づいてアラートに反応するのではなく、新しい悪意のあるアクティビティを明らかにするアナリストを対象としています。

# ハンティングパック

ハンティングパックは、RSA NetWitness Platform内のパケットトラフィックを分析し、特定のメタキーに調査のための自然言語値を入力することにより、侵害または異常なネットワークアクティビティのインジケータを素早く探し出すように設計されています。

ハンティングパックは、以下の別々の部分で構成されています。

- インジケータが設定された一連のメタキー
- メタデータの関連する組み合わせをアナリストに提供するメタグループのインポート
- 攻撃者が使用する一般的なプロトコルからネットワークセッションを解読する一連のLuaパーサー
- 調査フィードとRSA FirstWatch SSLブラックリストフィード。
- ハンティング関連のRSA NetWitnessレポート
- ハンティング関連のRSA NetWitnessルール
- Webshel​​lで検出されたESAルール：このルールは、10分の時間枠内で同じIP送信元と宛先のペアの間で3つのWebシェルが検出されたことを示します。詳細については、RSA ESA Rulesのトピックを参照してください。
- exeファイルタイプだがexe拡張子ではないアプリケーションルール

## ハンティングパックのデプロイ

ハンティングパックのすべてのアイテムをライブで展開することができます。

次の点に注意してください。

- 10.6.2より前のデプロイメントでは、netname、direction、ioc、boc、eoc、analysis.service、analysis.session、analysis.fileのような一連の新しいメタキーも設定する必要があります。 詳細は、「メタキー」を参照してください。
- trafflic_flow LuaパーサーはLog Decoderにデプロイできますが、現在はLiveでサポートされていません。 Traffic Flow Lua Parserのドキュメント（https://community.rsa.com/docs/DOC-44948）では、「Deploy to Log Decoders」セクションを参照してください。
- 展開できない環境にいる場合は、リソースパッケージを作成して、使用できるZIPアーカイブをダウンロードする必要があります。 バンドルでは機能しないので、ダウンロードボタンを使用しないでください。

## メタキー

Huntingコンテンツパックを構成するLuaパーサ展開の結果として生成されるメタキーは、次のとおりです。
これらは、RSA NetWitness Platformのバージョン10.6.2以降で追加構成なしで利用できます。
これより前のバージョンにコンテンツパックを展開する場合は、「付録：コンテンツパックのメタキーを使用する」を参照して、コンテンツパックを有効にする方法を参照してください。

|表示名|メタキー|書式|説明|
|:---:|:---:|:---:|:---|
|Behaviors of Compromise| boc | テキスト |標準的な署名ベースの検出以外の、疑わしい行為や不正な行為のために指定されています。
|Enablers of Compromise| eoc |テキスト|貧弱な情報や運用上の事例であり、セキュリティ侵害の根本原因につながる可能性があります。
|File Analysis| analysis.file | テキスト |ファイル特性と異常を強調する大規模な検査ライブラリです。
|Indicators of Compromise| ioc |テキスト|侵害のインジケータは、情報セキュリティの分野全体に遍在しています。分野に応じて分類保管することが重要です。
|Network Name| netname |テキスト|送信元または宛先にタグ付けされるネットワークおよびホストの記述です。これにより、複数のネットワークキーとアセットキーが不要になります。
|Service Analysis|analysis.service|サービス|テキスト|コアアプリケーションプロトコルを識別します。サービスベースの分析の根幹です。
|Session Analysis| analysis.session |テキスト|クライアント～サーバー通信の和、偏差、実行およびセッション属性です。
|Traffic Flow Direction|direction|テキスト|送信元と宛先から導出されたフローベースの情報。アウトバウンド、ラテラル、インバウンドのいずれかの値を持ちます。
